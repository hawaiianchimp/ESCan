{"ts":1378760443469,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\nrequire_once 'inc/standard.php';\n\n$page = new Page('login', ALL);\n\n$page->setTitle('Sign In');\n\n$ucinetid = $_POST['ucinetid'] or $_GET['ucinetid'];\n$person = new UCIPerson($ucinetid);\n$ucinetid = $person->ucinetid;\n\n$redirect = $_GET['redirect'];\n$login = new Login();\n\nif(isset($_SESSION['name']))\n{\n\t$message = 'You are already signed in as '.$_SESSION['ucinetid'].'. If you would like to logout, please visit the <a href=\"logout.php\">Log Out</a> page.';\n\t$page->setMessage($message, 'success');\n\t$bottom = ' <span class=\"alert\"> Hi '.$_SESSION['name'].',<br><br>'.$message.'</span>';\n\t$box = new Box('Already Signed In', $bottom);\n\t$page->setContent($box->display('half'));\n\t$page->buildPage();\n}\n\nif($_POST['action'] == 'login' && isset($_POST['ucinetid']))\n{\n\t$errors=1;\t\n\tif(!($login->login($ucinetid, $_POST['password'])))\n\t{\n\t\t$errors++;\n\t\t$error_message = $login->error;\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\tif($redirect)\n\t\t\theader('Location:'.$redirect);\n\t\telse\n\t\t{\n\t\t\theader('Location: settings.php');\n\t\t}\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'failure');\n\t}\n}\n$bottom = $login->loginform('login','login', 'settings.php', $ucinetid);\n\n$box = new Box('Login', $bottom);\n$box->setBadge('Register', 'register.php');\n\n$page->setContent($box->display('half'));\n$page->buildPage();\n?>\n"]],"start1":0,"start2":0,"length1":0,"length2":1298}]],"length":1298}
