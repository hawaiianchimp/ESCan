{"ts":1378760365913,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n\nrequire_once 'inc/standard.php';\n$page = new Page('recover', PARTICIPANT);\n$box = new Box('Recover');\n$ucinetid = $_GET['ucinetid'];\n$secret = $_GET['secret'];\n\nif($_GET['action'] == 'change' && isset($_GET['ucinetid']) && $_POST)\n{\n\t$errors_change = 1;\n\tif(!($page->login->exists($ucinetid)))\n\t{\n\t\t$errors_change++;\n\t\t$error_message[$errors_change] = $ucinetid.' is not registered with '.PRODUCT.'. Please register here at the <a href=\"register.php\">Registration Page</a>';\n\t}\n\tif(strlen($_POST['password']) < 6)\n\t{\n\t\t$errors_change++;\n\t\t$error_message[$errors_change] = 'Your new password is too short';\n\t}\n\t\n\tif($_POST['password'] != $_POST['password2'])\n\t{\n\t\t$errors_change++;\n\t\t$error_message[$errors_change] = 'Your passwords do not match';\n\t}\n\tif($errors_change == 1)\n\t{\n\t\t$e_password = md5($_POST['password']);\n\t\t$sql = \"UPDATE logon \n\t\t\t\tSET password = '$e_password'\n\t\t\t\tWHERE ucinetid = '$ucinetid'\n\t\t\t\tLIMIT 1\";\n\t\t$page->DB->query($sql);\n\t\t\n\t\t$sql = \"DELETE FROM reset\n\t\t\t\tWHERE ucinetid = '$ucinetid'\";\n\t\t$page->DB->query($sql);\n\t\t\n\t\t$page->setMessage('Your password has been successfully changed', 'success');\n\t\t$display_login = true;\n\t\t$page->login->logout();\n\t}\n\telse\n\t{\n\t\tif(is_array($error_message))\n\t\t{\n\t\t\t$error_message = implode(', ', $error_message);\n\t\t}\n\t\t\t\n\t\t$page->setMessage($error_message, 'failure');\n\t}\t\n\t\n}\n\nif($display_login)\n{\n\t$page->login->checkValidAccess($page, 'settings.php', $ucinetid);\n}\n\nif($_GET['ucinetid'] && $_GET['secret'])\n{\n\t$errors = 1;\n\t$sql = \"SELECT * FROM reset WHERE ucinetid = '$ucinetid' AND secret = '$secret'\";\n\t$result = $page->DB->query($sql);\n\t$user = $page->DB->resultToSingleArray();\n\t\n\tif($page->DB->isEmpty())\n\t{\n\t\t$errors++;\n\t\t$error_message = 'Sorry, there was an error with reseting your password please visit the <a href=\"iforgot.php\">Forgot Password</a> page to reset your password again.';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t$var_array = new VarArray();\n\t\t\n\t\t$bottom = '\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?action=change&ucinetid='.$ucinetid.'&secret='.$secret.'\" method=\"POST\">\n\t\t\t\t<div class=\"row\">\n\t\t\t\t    <label class=\"fieldname\" for=\"ucinetid\">\n\t\t\t\t        UCInetID \n\t\t\t\t        <span class=\"require1\">*</span>\n\t\t\t\t    </label>\n\t\t\t\t    <input class=\"textarea readonly\" name=\"ucinetid\" type=\"text\" value=\"'.$ucinetid.'\" readonly>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t    <label class=\"fieldname\" for=\"password\">\n\t\t\t\t        New Password\n\t\t\t\t        <span class=\"require1\">*</span>\n\t\t\t\t    </label>\n\t\t\t\t    <input class=\"textarea\" name=\"password\" type=\"password\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t    <label class=\"fieldname\" for=\"password2\">\n\t\t\t\t        Confirm\n\t\t\t\t        <span class=\"require1\">*</span>\n\t\t\t\t    </label>\n\t\t\t\t    <input class=\"textarea\" name=\"password2\" type=\"password\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"separator\"></div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t    <input type=\"submit\" value=\"Change Password\" name=\"submit_change\">\n\t\t\t\t</div>\n\t\t\t</form>';\n\t}\n\t\n\telse\n\t{\n\t\t$bottom = $error_message;\n\t}\n}\nelse\n{\n\t$bottom = 'You have arrived to this page in error, please return to the <a href=\"index.php\">Home Page</a>.';\n}\n\n$box->setContent($bottom);\n$page->setContent($box->display('half'));\n$page->buildPage();\n\n?>"]],"start1":0,"start2":0,"length1":0,"length2":3197}]],"length":3197}
