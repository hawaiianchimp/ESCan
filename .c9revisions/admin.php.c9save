{"ts":1379097748213,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\n\nrequire_once 'inc/standard.php';\n$page = new Page('admin', ADMINISTRATOR);\n$page->setTab('admin');\n$user_box = new Box('User Administration');\n$barcode_box = new Box('Barcode Administration');\n$danger_box = new Box('Danger');\n$js_slide_down = false;\n$barcode_focus = false;\n$select_from_post = false;\n$var_array = new VarArray();\n\n//check for valid access\nif(!$page->login->checkValidAccess($page, $_SERVER['PHP_SELF']))\n{\n\t$box = new Box('Access Denied', 'You do not have access to view this page');\n\t$page->setContent($box->display());\n\t$page->buildPage();\n}\n\n//clean each $_POST value of dangerous inputs\n//example $user['email'] = 'stburke@uci.edu';\nforeach ($_POST as $key => $value) {\n\t//echo '$user[\\''.$key.'\\'] = '.$value.';<br>';\n\t$user[$key] = trim(strip_tags($value));\n}\n$user['ucinetid'] = trim(strip_tags($_GET['ucinetid']));\n\n$access_menu_select = new DropMenu('select_access', $var_array->getAccess(true), $_GET['select_access'], 'textarea');\n\n//TODO finish this\n$bottom = '\n<form id=\"form_access\" action=\"'.$_SERVER['PHP_SELF'].'\" method=\"GET\">\n\t\t<div class=\"row\">\n\t\t\t<label class=\"fieldname\" for=\"users\">\n\t\t\tAccess\n\t\t\t</label>\n\t\t\t'.$access_menu_select->display().'\n\t\t</div>\n</form>\n<script>\n\t$(\"#select_access\").change(function () {\n\t          $(\"#form_access\").submit();\n\t          });\n</script>';\n\n\nif($_GET['select_access'])\n{\n\t$errors = 1;\n\t\n\tif(($_GET['select_access'] != PARTICIPANT) && \n\t($_GET['select_access'] != VOLUNTEER) && \n\t($_GET['select_access'] != ADMINISTRATOR) && \n\t($_GET['select_access'] != WEBMASTER))\n\t{\n\t\t$errors++;\n\t\t$error_message[$errors] = 'Invalid Access Type';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t$sql = 'SELECT u.name, u.ucinetid \n\t\t\tFROM users AS u\n\t\t\tWHERE access = \"'.$_GET['select_access'].'\"\n\t\t\tORDER BY name ASC';\n\t\n\t$page->DB->query($sql);\n\t$users = $page->DB->resultToMakeArray('ucinetid','name', 'Select User');\n\t$user_menu = new DropMenu('ucinetid', $users, $_GET['ucinetid'], 'textarea');\n\t\n\t$bottom .= ' \n\t<form id=\"ucinetid_form\" action=\"'.$_SERVER['PHP_SELF'].'#\" method=\"GET\">\n\t\t\t<div class=\"row\">\n\t\t\t\t<label class=\"fieldname\" for=\"users\">\n\t\t\t\tUsers\n\t\t\t\t</label>\n\t\t\t\t'.$user_menu->display().'\n\t\t\t</div>\n\t\t\t<input name=\"select_access\" type=\"hidden\" value=\"'.$_GET['select_access'].'\">\n\t</form>\n\t<script>\n\t\t$(\"#ucinetid\").change(function () {\n\t\t          $(\"#ucinetid_form\").submit();\n\t\t          });\n\t</script>';\n\t}\n\telse {\n\t\t$page->setMessage($error_message, 'failure');\n\t}\n}\n\nif($_GET['action'] == 'associate' && $_POST)\n{\n\t$barcode = new Barcode($user['barcode']);\n\tif(strlen($barcode->code) > 0)\n\t{\n\t\tif($barcode->associate($user['ucinetid']))\n\t\t{\n\t\t\t$page->setMessage('You have successfully associated barcode #'.$barcode->code.' to '.$user['ucinetid'].'\\'s account', 'success');\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$page->setMessage($barcode->error, 'failure');\n\t\t}\n\t}\n\telse \n\t{\n\t\tif($barcode->unassociate($user['ucinetid']))\n\t\t{\n\t\t\t$page->setMessage('You have successfully unassociated any barcode from this account', 'success');\n\t\t\tunset($user['barcode']);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$page->setMessage($barcode->error, 'failure');\n\t\t}\n\t}\n\t\n}\n\n\n\nif($_GET['action'] == 'update' && $_POST)\n{\n\t$errors = 1;\n\t\n\tif(strlen($user['name']) < 2)\n\t{\n\t\t$error_message[$errors] = \"This name is too short\";\n\t\t$errors++;\n\t\t$error_name = 'failure';\n\t}\n\tif($user['major'] == '')\n\t{\n\t\t$error_message[$errors] = \"Please select a major\";\n\t\t$errors++;\n\t\t$error_major = 'failure';\n\t}\n\tif($user['level'] == '')\n\t{\n\t\t$error_message[$errors] = \"Please select a level\";\n\t\t$errors++;\n\t\t$error_level = 'failure';\n\t}\n\t\n\tif(substr($user['email'], 0, strlen($user['ucinetid'])) != $user['ucinetid'])\n\t{\n\t\t$error_message[$errors] = \"The email must match the UCInetID\";\n\t\t$errors++;\n\t\t$error_email = 'failure';\n\t}\n\t\n\tif(substr($user['email'], strlen($user['ucinetid']), 8) != '@uci.edu')\n\t{\n\t\t$error_message[$errors] = \"You must use the UCI email address\";\n\t\t$errors++;\n\t\t$error_email = 'failure';\n\t}\n\t\n\tif((strlen($user['password_new']) != 0) || \n\t   (strlen($user['password_con']) != 0))\n\t{\n\n\t\tif(strlen($user['password_new']) < 6)\n\t\t{\n\t\t\t$errors++;\n\t\t\t$error_message[$errors] = 'Your password must be 6 characters or greater';\n\t\t\t$error_password_new = 'error';\n\t\t}\n\t\t\n\t\tif($user['password_new'] != $user['password_con'])\n\t\t{\n\t\t\t$errors++;\n\t\t\t$error_message[$errors] = 'Your passwords do not match';\n\t\t\t$error_password_con = 'error';\n\t\t}\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t$password_new = md5($user['password_new']);\n\t\t\n\t\tif((strlen($user['password_new']) != 0) && \n\t\t   (strlen($user['password_con']) != 0))\n\t\t{\n\t\t\t$sql = 'UPDATE logon \n\t\t\t\t\tSET password = \"'.$password_new.'\"\n\t\t\t\t\tWHERE ucinetid = \"'.$user['ucinetid'].'\"';\n\t\t\t\t\t\n\t\t\t$page->login->qry($sql);\n\t\t}\n\t\t\n\t\t$sql = 'UPDATE users SET\n\t\t\t\tname = \"'.$user['name'].'\",\n\t\t\t\taccess = \"'.$user['access'].'\",\n\t\t\t\tmajor = \"'.$user['major'].'\",\n\t\t\t\tlevel = \"'.$user['level'].'\",\n\t\t\t\topt = \"'.$user['opt'].'\"\n\t\t\t\tWHERE ucinetid = \"'.$user['ucinetid'].'\"\n\t\t\t\tLIMIT 1';\n\t\t\n\t\t$page->DB->execute($sql);\n\t\t$page->setMessage('Settings updated for user: <strong>'.$user['ucinetid'].'</strong>', 'success');\t\n\t\t$select_from_post = false;\t\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'failure');\n\t\t$select_from_post = true;\t\n\t}\n\n}\n\nif($_GET['action'] == \"DELETE EVENTS\")\n{\n\t$errors = 1;\n\t\n\tif($_GET['delete_continue'] != \"DELETE\")\n\t{\n\t\t$errors++;\n\t\t$error_message[0] = '\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING'].'\" method=\"GET\">\n\t\t\tAre you sure you want to delete all events?\n\t\t\t<input type=\"submit\" value=\"DELETE\" name=\"delete_continue\">\n\t\t\t<input type=\"hidden\" value=\"DELETE EVENTS\" name=\"action\">\n\t\t</form>';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t\n\t\t$sql = 'TRUNCATE TABLE events';\n\t\t\n\t\t$page->DB->execute($sql);\n\t\t$page->setMessage('All events have been deleted', 'failure');\t\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'error');\n\t}\n\n}\n\nif($_GET['action'] == \"DELETE PAGES\")\n{\n\t$errors = 1;\n\t\n\tif($_GET['delete_continue'] != \"DELETE\")\n\t{\n\t\t$errors++;\n\t\t$error_message[0] = '\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING'].'\" method=\"GET\">\n\t\t\tAre you sure you want to delete all pages?\n\t\t\t<input type=\"submit\" value=\"DELETE\" name=\"delete_continue\">\n\t\t\t<input type=\"hidden\" value=\"DELETE PAGES\" name=\"action\">\n\t\t</form>';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t$sql = 'TRUNCATE TABLE pages';\n\t\t$page->DB->execute($sql);\n\t\t$sql = 'TRUNCATE TABLE tabs';\n\t\t$page->DB->execute($sql);\n\t\t\n\t\t$page->setMessage('All pages have been deleted', 'failure');\t\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'error');\n\t}\n}\n\nif($_GET['action'] == \"DELETE USERS\")\n{\n\t$errors = 1;\n\t\n\tif($_GET['delete_continue'] != \"DELETE\")\n\t{\n\t\t$errors++;\n\t\t$error_message[0] = '\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING'].'\" method=\"GET\">\n\t\t\tAre you sure you want to delete all users?\n\t\t\t<input type=\"submit\" value=\"DELETE\" name=\"delete_continue\">\n\t\t\t<input type=\"hidden\" value=\"DELETE USERS\" name=\"action\">\n\t\t</form>';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t\n\t\t$sql = 'TRUNCATE TABLE logon'; \n\t\t$page->DB->execute($sql);\n\t\t$sql = 'TRUNCATE TABLE users';\n\t\t$page->DB->execute($sql);\n\t\t$sql = 'TRUNCATE TABLE reset';\n\t\t$page->DB->execute($sql);\n\t\t\n\t\t\n\t\t$sql = 'REPLACE INTO `users` VALUES(\"'.WEBMASTER_USERNAME.'\", \"\", \"\", \"'.WEBMASTER_EMAIL.'\", \"\", \"\", 1, 8, 1, \"\", \"\", \"_setup.php\")';\n\t\t$db->execute($sql);\n\t\t$sql = 'REPLACE INTO `logon` VALUES(\"'.WEBMASTER_USERNAME.'\", \"'.md5(WEBMASTER_PASSWORD).'\", \"\", \"\", \"\")';\n\t\t$db->execute($sql);\n\t\t\t\n\t\t$page->setMessage('All users have been deleted', 'failure');\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'error');\n\t}\n}\n\nif($_GET['action'] == \"DELETE SCANS\")\n{\n\t$errors = 1;\n\t\n\tif($_GET['delete_continue'] != \"DELETE\")\n\t{\n\t\t$errors++;\n\t\t$error_message[0] = '\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING'].'\" method=\"GET\">\n\t\t\tAre you sure you want to delete all scans?\n\t\t\t<input type=\"submit\" value=\"DELETE\" name=\"delete_continue\">\n\t\t\t<input type=\"hidden\" value=\"DELETE SCANS\" name=\"action\">\n\t\t</form>';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t\n\t\t$sql = 'TRUNCATE TABLE scans'; \n\t\t$page->DB->execute($sql);\n\t\t\t\n\t\t$page->setMessage('All scans have been deleted', 'failure');\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'error');\n\t}\n}\n\nif($_GET['action'] == \"DELETE BARCODES\")\n{\n\t$errors = 1;\n\t\n\tif($_GET['delete_continue'] != \"DELETE\")\n\t{\n\t\t$errors++;\n\t\t$error_message[0] = '\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?'.$_SERVER['QUERY_STRING'].'\" method=\"GET\">\n\t\t\tAre you sure you want to delete all barcodes?\n\t\t\t<input type=\"submit\" value=\"DELETE\" name=\"delete_continue\">\n\t\t\t<input type=\"hidden\" value=\"DELETE SCANS\" name=\"action\">\n\t\t</form>';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\t\n\t\t$sql = 'TRUNCATE TABLE barcodes'; \n\t\t$page->DB->execute($sql);\n\t\t\t\n\t\t$page->setMessage('All scans have been deleted', 'failure');\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'error');\n\t}\n}\n\n\n\t\nif($user['ucinetid'])\n{\n\t$errors = 1;\n\t\n\tif(!($page->login->exists($user['ucinetid'])))\n\t{\n\t\t$errors++;\n\t\t$error_message[$errors] = $user['ucinetid'].'is not registered with '.PRODUCT.'. Please register here at the <a href=\"register.php\">Registration Page</a>';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t$sql = 'SELECT u.*\n\t\t\tFROM users AS u\n\t\t\tWHERE ucinetid = \"'.$user['ucinetid'].'\"\n\t\t\tORDER BY name ASC';\n\t\n\t$page->DB->query($sql);\n\t$user = $page->DB->resultToSingleArray();\n\t\n\t//clean each $_POST value of dangerous inputs\n\t//example $user['email'] = 'stburke@uci.edu';\n\tforeach ($_POST as $key => $value) {\n\t\t//echo '$user[\\''.$key.'\\'] = '.$value.';<br>';\n\t\t$update[$key] = trim(strip_tags($value));\n\t}\n\t\n\tforeach ($user as $key => $value) {\n\t\t$display[$key] = ($select_from_post) ? $update[$key]:$user[$key];\n\t\t$class[$key] = ($select_from_post) ? 'success':'';\n\t}\n\t$display['barcode'] = ($select_from_post) ? '':$user['barcode'] ;\n\t\n\t\t$bottom .= '\n\t\t<div class=\"separator\"></div>\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?ucinetid='.$_GET['ucinetid'].'&select_access='.$_GET['select_access'].'&action=update\" method=\"POST\">\n\t\t\t<div class=\"row\">\n\t\t\t    <label class=\"fieldname\" for=\"ucinetid\">\n\t\t\t        UCInetID\n\t\t\t    </label>\n\t\t\t    <input class=\"textarea readonly\" name=\"ucinetid\" type=\"text\" value=\"'.$display['ucinetid'].'\" READONLY>\n\t\t\t</div>\n\t\t\t<div class=\"row '.$class['email'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"email\">\n\t\t\t        Email\n\t\t\t    </label>\n\t\t\t    <input class=\"textarea\" name=\"email\" type=\"email\" value=\"'.$display['email'].'\">\n\t\t\t</div>\n\t\t\t<div class=\"row '.$class['name'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"name\">\n\t\t\t        Name\n\t\t\t    </label>\n\t\t\t    <input class=\"textarea\" name=\"name\" type=\"text\" value=\"'.$display['name'].'\">\n\t\t\t</div>';\n\t\t\t//echo 'display\t:'.$display['access'].'<br>';\n\t\t\t//echo 'POST\t\t:'.$_POST['access'].'<br>';\n\t\t\t//echo 'user\t\t:'.$user['access'].'<br>';\n\t\t\t//echo 'update\t:'.$update['access'].'<br>';\n\t\t$access_update = new DropMenu('access', $var_array->getAccess('setIntial'), $display['access'], 'textarea');\n\t\t$major_menu = new DropMenu('major', $var_array->getMajors('setIntial'), $display['major'], 'textarea');\n\t\t$level_menu = new DropMenu('level', $var_array->getLevels('setIntial'), $display['level'], 'textarea');\n\t\t\n\t\t$bottom .= '\n\t\t\t<div class=\"row '.$class['access'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"name\">\n\t\t\t        Access\n\t\t\t    </label>\n\t\t\t    '.$access_update->display().'\n\t\t\t</div>\n\t\t\t<div class=\"row '.$class['major'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"major\">\n\t\t\t    Major\n\t\t\t    </label>'.$major_menu->display().'\n\t\t\t</div>\n\t\t\t<div id=\"major_input\" class=\"row '.$class['major'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"major\">Major <span class=\"require1\">*</span>\n\t\t\t    </label>\n\t\t\t    <input id=\"major_val\" class=\"textarea\" placeholder=\"major\" name=\"major_val\" type=\"text\" value=\"'.$display['major'].'\">\n\t\t\t</div>\n\t\t\t<div class=\"row '.$class['level'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"level\">\n\t\t\t        Level\n\t\t\t    </label>\n\t\t\t    '.$level_menu->display().'\n\t\t\t</div>\n\t\t\t<div class=\"row  '.$class['opt'].'\">\n\t\t\t    <label class=\"fieldname\" for=\"opt\">\n\t\t\t        Receive Emails?\n\t\t    \t</label>\n\t\t    <div class=\"separator\"></div>\n\t\t    <div class=\"row '.$error_password_new.'\">\n\t\t        <label class=\"fieldname\" for=\"password_new\">\n\t\t            New Password\n\t\t            <span class=\"require1\">*</span>\n\t\t        </label>\n\t\t        <input class=\"textarea\" name=\"password_new\" type=\"password\">\n\t\t    </div>\n\t\t    <div class=\"row '.$error_password_con.'\">\n\t\t        <label class=\"fieldname\" for=\"password_con\">\n\t\t            Confirm\n\t\t            <span class=\"require1\">*</span>\n\t\t        </label>\n\t\t        <input class=\"textarea\" name=\"password_con\" type=\"password\">\n\t\t    </div>\n\t\t    <div class=\"separator\"></div>\n\t\t    ';\n\t\t\t    \n\t\t\t$opt_checked = ($display['opt'] == '') ? '':'CHECKED';\n\t\t\t    \n\t\t\t$bottom .= '<input name=\"opt\" type=\"checkbox\" class=\"textarea\" '.$opt_checked.'>\n\t\t\t</div>\n\t\t\t<div class=\"row\">\n\t\t\t    <input type=\"submit\" value=\"Update\" name=\"action\">\n\t\t\t</div>\n\t\t</form>\n\t\t<div class=\"separator\"></div>\n\t\t<div class=\"row\">\n\t\t\t<img src=\"images/wristband.png\" class=\"wristband\">\n\t\t</div>\n\t\t<form action=\"'.$_SERVER['PHP_SELF'].'?ucinetid='.$_GET['ucinetid'].'&select_access='.$_GET['select_access'].'&action=associate\" method=\"POST\">\n\t\t\n\t\t\t<div class=\"row\" '.$class['barcode'].'>\n\t\t\t   <label class=\"fieldname\" for=\"barcode\">\n\t\t\t       Barcode\n\t\t\t   </label>\n\t\t\t   <input class=\"textarea\" name=\"barcode\" type=\"text\" value=\"'.$display['barcode'].'\">\n\t\t\t</div>\n\t\t\t<div class=\"row\">\n\t\t\t    <input type=\"submit\" value=\"Associate\" name=\"action\">\n\t\t\t</div>\n\t\t</form>\n\t\t<script>\n\t\t$(document).ready( function(){\n\t\t\tif($(\"#major\").val() != \"Other\")\n\t\t\t{\n\t\t\t\t$(\"#major_input\").hide();\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(\"#major\").change(function () {\n\t\t\t\t  if($(\"#major\").val() == \"Other\")\n\t\t\t\t  {\n\t\t\t\t  \t$(\"#major_val\").val(\"'.$display['major'].'\");\n\t\t          \t$(\"#major_input\").slideDown(\"fast\");\n\t\t          }\n\t\t          else{\n\t\t          \t$(\"#major_val\").val($(\"#major\").val());\n\t\t          \t$(\"#major_input\").slideUp(\"fast\");\n\t\t          }\n\t\t          });\n\t\t</script>';\n\t\n\t}\n\telse {\n\t\t$page->setMessage($error_message, 'failure');\n\t}\n}\n\n/* Barcode Section\n *\n *\n *\n */\n\nif($_GET['action'] == 'Register')\n{\n\t$barcode = new Barcode($_GET['barcode']);\n\t$errors = 1;\n\tif($barcode->code == '')\n\t{\n\t\t$errors++;\n\t\t$error_message[$errors] = 'Please enter a barcode';\n\t\t$error_barcode = 'failure';\n\t}\n\telseif($barcode->exists())\n\t{\n\t\t$errors++;\n\t\t$error_message[$errors] = 'The barcode #'.$barcode->code.' already exists in the system';\n\t\t$error_barcode = 'failure';\n\t}\n\t\n\tif($errors == 1)\n\t{\n\t\tif($barcode->register())\n\t\t{\n\t\t\t$page->setMessage('Registered: #'.$barcode->code, 'success');\n\t\t\t$js_slide_down = true;\n\t\t}\n\t\telse{\n\t\t\t$page->setMessage($barcode->error, 'failure');\n\t\t}\n\t}\n\telse\n\t{\n\t\t$page->setMessage($error_message, 'failure');\n\t}\n\t$barcode_focus = true; //set the focus of the barcode field to true\n\t\n}\n\n$ticker_content .= '\n\t\t<div class=\" \">\n\t\t\t<div class=\"separator\"></div>\n\t\t\t<form action=\"'.$_SERVER['PHP_SELF'].'\" method=\"GET\">\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label>Barcode</label>\n\t\t\t\t\t<input type=\"tel\" name=\"barcode\" id=\"barcode\">\n\t\t\t\t\t<input type=\"submit\" name=\"action\" value=\"Register\" class=\"right\">\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>';\n\n$limit = ($_GET['view'] == 'all') ? '':'LIMIT 5';\n\n$sql = 'SELECT barcodes.*, users.name, users.ucinetid, users.major, users.level\n\t\tFROM barcodes LEFT JOIN users\n\t\tON barcodes.ucinetid = users.ucinetid\n\t\tORDER BY date DESC, time DESC\n\t\t'.$limit;\n\t\t\n$page->DB->query($sql);\n$ticker_array = $page->DB->resultToArray();\n$ticker_content .= '<div class=\"separator\"></div>';\n$ticker_content .= '<div class=\"row center\">\n\t\t\t\t\t\t<h3>Barcode Ticker</h3>\n\t\t\t\t\t</div>';\n\t\t\t\t\t\n$ticker_content .= '<div class=\"list\">';\n\n/* Start doing the JavaScript \n *\n */\n \n//set initial javascript\nif($js_slide_down)\n\t$js_hide_row1 = '$(\"#row1\").hide();';\n$page->setJSInitial('$(\".dropdown\").hide(); '.$js_hide_row1);\n\t\n//set javascript after page is ready\n$ticker_content .= '<script>\n\t$(document).ready(function () {';\nif($barcode_focus)\n\t$ticker_content .= '$(\"#barcode\").focus();';\nif($js_slide_down)\n\t$ticker_content .= '$(\"#row1\").slideDown();';\n\n$ticker_content .= '});</script>';\n\t\nif(count($ticker_array) > 0)\n{\n\t\n\tforeach ($ticker_array as $row)\n\t{\n\t\t$i++;\n\t\t\n\t\t$ticker_content .= '\n\t\t\t<div class=\"item\" id=\"row'.$i.'\">\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"barcode\">Barcode: </span> #'.$row['barcode'].'</label>\n\t\t\t\t\t<span class=\"right\">'.$row['name'].'</span>\n\t\t\t\t\t<span class=\"date\">'.date('M j,', strtotime($row['date'])).'</span>\n\t\t\t\t\t<span class=\"time\">'.date('g:i:s A', strtotime($row['time'])).'</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"event_row\">\n\t\t\t\t<script>\n\t\t\t\t    $(\"#row'.$i.'\").click(function () {\n\t\t\t\t    \t$(\"#drop'.$i.'\").slideToggle(\"fast\");\n\t\t\t\t    });\n\t\t\t\t</script>\n\t\t\t\t<div class=\"dropdown\" id=\"drop'.$i.'\" style=\"display:none;\">\n\t\t\t\t\t<h5><strong>UCInetID:</strong> \t'.$row['ucinetid'].'</h5>\n\t\t\t\t\t<h5><strong>Name:</strong> \t\t'.$row['name'].'</h5>\n\t\t\t\t\t<h5><strong>Major:</strong> \t\t'.$row['major'].'</h5>\n\t\t\t\t\t<h5><strong>Level:</strong> \t\t'.$row['level'].'</h5>\n\t\t\t\t\t<h5><strong>Time:</strong> \t\t'.date('F j, Y g:i:s A', strtotime($row['date'].' '.$row['time'])).'</h5>\n\t\t\t\t</div>\n\t\t\t</div>';\n\t}\n\t\n\t//view all link at the bottom of page\n\tif($_GET['view'] == 'all')\n\t{\n\t$ticker_content .= '\n\t\t<div class=\"row center\">\n\t\t\t<label id=\"view\">\n\t\t\t\t<a href=\"'.$_SERVER['PHP_SELF'].'?view=less#view\">View Less Barcodes</a>\n\t\t\t</label>\n\t\t</div>';\n\t}\n\telse \n\t{\n\t$ticker_content .= '\n\t\t<div class=\"row center\">\n\t\t\t<label id=\"view\">\n\t\t\t\t<a href=\"'.$_SERVER['PHP_SELF'].'?view=all#view\">View All Barcodes</a>\n\t\t\t</label>\n\t\t</div>';\n\t}\n}\nelse {\n\t$ticker_content .= '\n\t<div class=\"list\">\n\t<div class=\"row\">\n\t\t<label>No Barcodes Yet</label>\n\t</div>\n\t</div>';\n}\n$ticker_content .= '</div>';\n\n\n//$slot = new Vegas($page,$users);\n//$slot_content = $slot->build();\n\n$danger_content .= '<a href=\"\">Reinstall</a><br>';\n$danger_content .= '\n\n<form id=\"truncate_events\" action=\"'.$_SERVER['PHP_SELF'].'\" method=\"GET\">\n\t<input type=\"submit\" name=\"action\" value=\"DELETE EVENTS\">\n\t<div class=\"clear\"></div>\n\t<input type=\"submit\" name=\"action\" value=\"DELETE USERS\">\n\t<div class=\"clear\"></div>\n\t<input type=\"submit\" name=\"action\" value=\"DELETE BARCODES\">\n\t<div class=\"clear\"></div>\n\t<input type=\"submit\" name=\"action\" value=\"DELETE PAGES\">\n\t<div class=\"clear\"></div>\n\t<input type=\"submit\" name=\"action\" value=\"DELETE SCANS\">\n\t<div class=\"clear\"></div>\n\t<input type=\"submit\" name=\"action\" value=\"REINSTALL\">\n\t<div class=\"clear\"></div>\n</form>';\n\n\n$user_box->setContent($bottom.$slot_content);\n$barcode_box->setContent($ticker_content);\n$danger_box->setContent($danger_content);\n\n\n$content = '<div id=\"container_wrapper\">'.\n\t\t\t\t$user_box->display('full')\n\t\t\t\t.'<div class=\"separator\"></div>'.\n\t\t\t\t$barcode_box->display('full')\n\t\t\t\t.'<div class=\"separator\"></div>'.\n\t\t\t\t$danger_box->display('full')\n\t\t\t.'</div>';\n\n$page->setContent($content);\n$page->buildPage();\n\n?>"]],"start1":0,"start2":0,"length1":0,"length2":18903}]],"length":18903}
{"contributors":[],"silentsave":false,"ts":1379102202981,"patch":[[{"diffs":[[0,"etup.php\")';\n\t\t$"],[1,"page->"],[0,"db->execute($sql"]],"start1":7240,"start2":7240,"length1":32,"length2":38},{"diffs":[[0,"\")';\n\t\t$"],[1,"page->"],[0,"db->exec"]],"start1":7385,"start2":7385,"length1":16,"length2":22}]],"length":18915,"saved":false}
{"ts":1379102219898,"patch":[[{"diffs":[[0,"hp\")';\n\t\t$page->"],[-1,"db"],[1,"DB"],[0,"->execute($sql);"]],"start1":7246,"start2":7246,"length1":34,"length2":34},{"diffs":[[0,"ge->"],[-1,"db"],[1,"DB"],[0,"->ex"]],"start1":7395,"start2":7395,"length1":10,"length2":10}]],"length":18915,"saved":false}
{"ts":1379102618007,"patch":[[{"diffs":[[0,"LE logon'; \n"],[1,"\t\t$sql = 'DELETE FROM logon WHERE `access` NOT IN (\"'.WEBMASTER.'\")';\n"],[0,"\t\t$page->DB-"]],"start1":6949,"start2":6949,"length1":24,"length2":94}]],"length":18985,"saved":false}
{"ts":1379102809844,"patch":[[{"diffs":[[0,"\n\t{\n"],[-1,"\t\t\n\t\t$sql = 'TRUNCATE TABLE logon'; \n"],[0,"\t\t$s"]],"start1":6920,"start2":6920,"length1":45,"length2":8},{"diffs":[[0,"ROM "],[-1,"logon"],[1,"users"],[0," WHERE "],[-1,"`"],[1,"\""],[0,"access"],[-1,"`"],[1,"\""],[0," NOT"]],"start1":6942,"start2":6942,"length1":28,"length2":28},{"diffs":[[0," = '"],[-1,"TRUNCATE TABLE users"],[1,"DELETE FROM users WHERE \"ucinetid\" NOT IN (SELECT users.ucinetid FROM users)"],[0,"';"],[1," "],[0,"\n\t\t$"]],"start1":7028,"start2":7028,"length1":30,"length2":87}]],"length":19005,"saved":false}
{"ts":1379103404937,"patch":[[{"diffs":[[0," = 'DELETE FROM "],[-1,"users"],[1,"logon"],[0," WHERE \"ucinetid"]],"start1":7028,"start2":7028,"length1":37,"length2":37},{"diffs":[[0,"l);\n\t\t\n\t\t\n\t\t"],[1,"//"],[0,"$sql = 'REPL"]],"start1":7197,"start2":7197,"length1":24,"length2":26},{"diffs":[[0,"p.php\")';\n\t\t"],[1,"//"],[0,"$page->DB->e"]],"start1":7335,"start2":7335,"length1":24,"length2":26},{"diffs":[[0,"xecute($sql);\n\t\t"],[1,"//"],[0,"$sql = 'REPLACE "]],"start1":7361,"start2":7361,"length1":32,"length2":34}]],"length":19011,"saved":false}
{"ts":1379103407532,"patch":[[{"diffs":[[0,"\"\", \"\")';\n\t\t"],[1,"//"],[0,"$page->DB->e"]],"start1":7476,"start2":7476,"length1":24,"length2":26}]],"length":19013,"saved":false}
{"contributors":[],"silentsave":false,"ts":1379106065461,"patch":[[{"diffs":[[0,"\t\t\n\t\t\n\t\t"],[-1,"//"],[0,"$sql = '"]],"start1":7201,"start2":7201,"length1":18,"length2":16},{"diffs":[[0,"p.php\")';\n\t\t"],[-1,"//"],[0,"$page->DB->e"]],"start1":7333,"start2":7333,"length1":26,"length2":24},{"diffs":[[0,"sql);\n\t\t"],[-1,"//"],[0,"$sql = '"]],"start1":7365,"start2":7365,"length1":18,"length2":16},{"diffs":[[0,"\"\")';\n\t\t"],[-1,"//"],[0,"$page->D"]],"start1":7474,"start2":7474,"length1":18,"length2":16}]],"length":19005,"saved":false}
{"contributors":[],"silentsave":false,"ts":1379367834460,"patch":[[{"diffs":[[0,"DB->execute($sql"],[1," , 1"],[0,");\n"],[-1,""],[0,"\t\t$sql = 'DELETE"]],"start1":7003,"start2":7003,"length1":35,"length2":39},{"diffs":[[0,"DB->execute($sql"],[1,", 1"],[0,");\n\t\t$sql = 'TRU"]],"start1":7125,"start2":7125,"length1":32,"length2":35},{"diffs":[[0,"DB->execute($sql"],[1,", 1"],[0,");\n\t\t\n\t\t\n\t\t$sql "]],"start1":7189,"start2":7189,"length1":32,"length2":35},{"diffs":[[0,"DB->execute($sql"],[1,", 1"],[0,");\n\t\t$sql = 'REP"]],"start1":7362,"start2":7362,"length1":32,"length2":35},{"diffs":[[0,", \"\", \"\")';\n"],[-1,""],[0,"\t\t$page->DB-"]],"start1":7481,"start2":7481,"length1":24,"length2":24},{"diffs":[[0,"DB->execute($sql"],[1,", 1"],[0,");\n\t\t\t\n\t\t$page->"]],"start1":7502,"start2":7502,"length1":32,"length2":35}]],"length":19021,"saved":false}
{"contributors":[],"silentsave":false,"ts":1379372821028,"patch":[[{"diffs":[[0,"iv>\n"],[-1,"\t<input type=\"submit\" name=\"action\" value=\"DELETE PAGES\">\n\t<div class=\"clear\"></div>\n"],[0,"\t<in"]],"start1":18336,"start2":18336,"length1":93,"length2":8}]],"length":18936,"saved":false}
{"ts":1379372880341,"patch":[[{"diffs":[[0,"error');\n\t}\n\n}\n\n"],[1,"/*\n * Why did I implement this feature in the first place??\n *\n \n"],[0,"if($_GET['action"]],"start1":5796,"start2":5796,"length1":32,"length2":97},{"diffs":[[0,", 'error');\n\t}\n}"],[1,"*/"],[0,"\n\nif($_GET['acti"]],"start1":6541,"start2":6541,"length1":32,"length2":34}]],"length":19003,"saved":false}
{"ts":1379373059749,"patch":[[{"diffs":[[0,");\n\n"],[-1,"$danger_content .= '<a href=\"\">Reinstall</a><br>';\n"],[0,"$dan"]],"start1":17996,"start2":17996,"length1":59,"length2":8}]],"length":18952,"saved":false}
{"contributors":[],"silentsave":false,"ts":1379373199687,"patch":[[{"diffs":[[0,"   \t</label>"],[1,"<input name=\"opt\" type=\"checkbox\" class=\"textarea\" '.$opt_checked.'>\n\t\t\t</div>"],[0,"\n\t\t    <div "]],"start1":12171,"start2":12171,"length1":24,"length2":102},{"diffs":[[0,".= '"],[-1,"<input name=\"opt\" type=\"checkbox\" class=\"textarea\" '.$opt_checked.'>\n\t\t\t</div>"],[0,"\n\t\t\t"]],"start1":12981,"start2":12981,"length1":86,"length2":8}]],"length":18952,"saved":false}
{"ts":1379373221655,"patch":[[{"diffs":[[0,"cked.'>\n"],[-1,"\t\t\t</div>\n"],[0,"\t\t    <d"]],"start1":12244,"start2":12244,"length1":26,"length2":16}]],"length":18942,"saved":false}
{"ts":1379373258237,"patch":[[{"diffs":[[0,"Emails?\n"],[1,"\t\t    ';\n\t\t\t    \n\t\t\t$opt_checked = ($display['opt'] == '') ? '':'CHECKED';\n\t\t\t    \n\t\t\t$bottom .= '\n"],[0,"\t\t    \t<"]],"start1":12160,"start2":12160,"length1":16,"length2":115},{"diffs":[[0,"iv>\n"],[-1,"\t\t    ';\n\t\t\t    \n\t\t\t$opt_checked = ($display['opt'] == '') ? '':'CHECKED';\n\t\t\t    \n\t\t\t$bottom .= '\n"],[0,"\t\t\t<"]],"start1":12972,"start2":12972,"length1":107,"length2":8}]],"length":18942,"saved":false}
{"ts":1379373352220,"patch":[[{"diffs":[[0,"ay().'\n\t\t\t</div>"],[1,"';\n\t\t\t    \n\t\t\t$opt_checked = ($display['opt'] == '') ? '':'CHECKED';\n\t\t\t    \n\t\t\t$bottom .= '"],[0,"\n\t\t\t<div class=\""]],"start1":12041,"start2":12041,"length1":32,"length2":124},{"diffs":[[0,"ls?\n"],[-1,"\t\t    ';\n\t\t\t    \n\t\t\t$opt_checked = ($display['opt'] == '') ? '':'CHECKED';\n\t\t\t    \n\t\t\t$bottom .= '\n"],[0,"\t\t  "]],"start1":12256,"start2":12256,"length1":107,"length2":8},{"diffs":[[0,"cked.'>\n"],[1,"\t\t    </div>\n"],[0,"\t\t    <d"]],"start1":12336,"start2":12336,"length1":16,"length2":29}]],"length":18948,"saved":false}
{"ts":1379373381273,"patch":[[{"diffs":[[0,"heckbox\""],[-1," class=\"textarea\""],[0," '.$opt_"]],"start1":12300,"start2":12300,"length1":33,"length2":16}]],"length":18931,"saved":false}
{"ts":1379373390588,"patch":[[{"diffs":[[0,"heckbox\""],[1," class=\"right\""],[0," '.$opt_"]],"start1":12300,"start2":12300,"length1":16,"length2":30}]],"length":18945,"saved":false}
{"ts":1379373536351,"patch":[[{"diffs":[[0,"NOT IN ("],[-1,"\""],[0,"'.WEBMAS"]],"start1":7034,"start2":7034,"length1":17,"length2":16},{"diffs":[[0,"MASTER.'"],[-1,"\""],[0,")';\n\t\t$p"]],"start1":7047,"start2":7047,"length1":17,"length2":16}]],"length":18943,"saved":false}
{"ts":1379373659460,"patch":[[{"diffs":[[0,"access\" "],[-1,"NOT IN ("],[1,"!= "],[0,"'.WEBMAS"]],"start1":7026,"start2":7026,"length1":24,"length2":19},{"diffs":[[0,"MASTER.'"],[-1,")"],[1,";"],[0,"';\n\t\t$pa"]],"start1":7042,"start2":7042,"length1":17,"length2":17}]],"length":18938,"saved":false}
{"ts":1379373854324,"patch":[[{"diffs":[[0,"ERE "],[-1,"\""],[0,"access"],[-1,"\""],[0," != "]],"start1":7021,"start2":7021,"length1":16,"length2":14},{"diffs":[[0,"n WHERE "],[-1,"\""],[0,"ucinetid"],[-1,"\""],[0," NOT IN "]],"start1":7110,"start2":7110,"length1":26,"length2":24}]],"length":18934,"saved":false}
{"ts":1379374187591,"patch":[[{"diffs":[[0,"1);\n\t\t\n\t\t\n\t\t"],[1,"//"],[0,"$sql = 'REPL"]],"start1":7263,"start2":7263,"length1":24,"length2":26},{"diffs":[[0,"p.php\")';\n\t\t"],[1,"//"],[0,"$page->DB->e"]],"start1":7401,"start2":7401,"length1":24,"length2":26},{"diffs":[[0,"ute($sql, 1);\n\t\t"],[1,"//"],[0,"$sql = 'REPLACE "]],"start1":7430,"start2":7430,"length1":32,"length2":34},{"diffs":[[0,"\"\", \"\")';\n\t\t"],[1,"//"],[0,"$page->DB->e"]],"start1":7545,"start2":7545,"length1":24,"length2":26},{"diffs":[[0,"ll users"],[1," (except Webmasters)"],[0," have be"]],"start1":7614,"start2":7614,"length1":16,"length2":36}]],"length":18962,"saved":false}
{"ts":1379374321575,"patch":[[{"diffs":[[0,"errors == 1)\n\t{\n"],[1,"\t    //delete all but webmasters\n\t    \n"],[0,"\t\t$sql = 'DELETE"]],"start1":6975,"start2":6975,"length1":32,"length2":71}]],"length":19001,"saved":false}
{"ts":1379374336062,"patch":[[{"diffs":[[0,"1);\n"],[-1,"\t\t\n\t\t\n\t\t//$sql = 'REPLACE INTO `users` VALUES(\"'.WEBMASTER_USERNAME.'\", \"\", \"\", \"'.WEBMASTER_EMAIL.'\", \"\", \"\", 1, 8, 1, \"\", \"\", \"_setup.php\")';\n\t\t//$page->DB->execute($sql, 1);\n\t\t//$sql = 'REPLACE INTO `logon` VALUES(\"'.WEBMASTER_USERNAME.'\", \"'.md5(WEBMASTER_PASSWORD).'\", \"\", \"\", \"\")';\n\t\t//$page->DB->execute($sql, 1);\n"],[0,"\t\t\t\n"]],"start1":7302,"start2":7302,"length1":329,"length2":8}]],"length":18680,"saved":false}
