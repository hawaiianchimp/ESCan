{"ts":1378759403838,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\nrequire_once 'inc/standard.php';\n\n//$page = new Page($name, $css);\n$page = new Page('event', ALL);\n$var = new VarArray();\n//clean each $_POST value of dangerous ps\n//example $newsettings['email'] = 'stburke@uci.edu';\n\nif(!$_GET['eid'])\n{\n\t$bottom = 'No event selected, please return to the <a href=\"events.php\">Events Page</a>.';\n\t\n\t$box = new Box('No Existing Event');\n\t$box->setBadge('Return to Events', 'events.php');\n\t\n\t$box->setContent($bottom);\n\t$page->setContent($box->display('half'));\n\t$page->buildPage();\n}\nelse\n{\n\t$sql = 'SELECT * FROM events\n\t\t\tWHERE eid =\"'.$_GET['eid'].'\"';\n\t$page->DB->query($sql);\n\t$event = $page->DB->resultToSingleArray();\n\t\n\t$total_count = $page->DB->countOf('scans', 'eid = \"'.$_GET['eid'].'\"');\n\t\n\t$box = new Box($event['name']);\n\t$box->setBadge('Return to Events', 'events.php');\n\t$bottom = '\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Name</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.$event['name'].'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Date</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.date('l, M d, Y',strtotime($event['date'])).'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Time</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.date('g:i a',strtotime($event['time'])).'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Host</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.$event['host'].'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Prize</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.$event['prize'].'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Description</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.$event['description'].'\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"row\">\n\t\t\t\t\t<label class=\"fieldname\">Total Participants</label>\n\t\t\t\t\t<div class=\"textarea\">\n\t\t\t\t\t'.$total_count.'\n\t\t\t\t\t</div>\n\t\t\t\t</div>';\n\t\t\t\t\n\t\t\t\t\n\t$limit = ($_GET['view'] == 'all') ? '':'LIMIT 5';\n\t\n\t$sql = 'SELECT scans.*, users.name, users.ucinetid, users.major, users.level\n\t\t\tFROM scans LEFT JOIN users\n\t\t\tON scans.barcode = users.barcode\n\t\t\tWHERE scans.eid = \"'.$_GET['eid'].'\"\n\t\t\tORDER BY date DESC, time DESC\n\t\t\t'.$limit;\n\t\t\t\n\t$page->DB->query($sql);\n\t$ticker_array = $page->DB->resultToArray();\n\t$ticker_content .= '<div class=\"separator\"></div>';\n\t$ticker_content .= '<div class=\"row center\">\n\t\t\t\t\t\t\t<h3>Scan Ticker</h3>\n\t\t\t\t\t\t</div>';\n\t\t\t\t\t\t\n\t$ticker_content .= '<div class=\"list\">';\n\t\n\t/* Start doing the JavaScript \n\t *\n\t */\n\t \n\t//set initial javascript\n\tif($js_slide_down)\n\t\t$js_hide_row1 = '$(\"#row1\").hide();';\n\t$page->setJSInitial('$(\".dropdown\").hide(); '.$js_hide_row1);\n\t\t\n\t//set javascript after page is ready\n\t$ticker_content .= '<script>\n\t\t$(document).ready(function () {\n\t\t\t$(\"#barcode\").focus();';\n\tif($js_slide_down)\n\t $ticker_content .= '$(\"#row1\").slideDown();';\n\t\n\t$ticker_content .= '});</script>';\n\t\t\n\tif(count($ticker_array) > 0)\n\t{\n\t\t\n\t\tforeach ($ticker_array as $row)\n\t\t{\n\t\t\t$i++;\n\t\t\t\n\t\t\t$ticker_content .= '\n\t\t\t\t<div class=\"item\" id=\"row'.$i.'\">\n\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t<label class=\"barcode\">Barcode: </span> #'.$row['barcode'].'</label>\n\t\t\t\t\t\t<span class=\"right\">'.$row['name'].'</span>\n\t\t\t\t\t\t<span class=\"date\">'.date('M j,', strtotime($row['date'])).'</span>\n\t\t\t\t\t\t<span class=\"time\">'.date('g:i:s A', strtotime($row['time'])).'</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"event_row\">\n\t\t\t\t\t<script>\n\t\t\t\t\t    $(\"#row'.$i.'\").click(function () {\n\t\t\t\t\t    \t$(\"#drop'.$i.'\").slideToggle(\"fast\");\n\t\t\t\t\t    });\n\t\t\t\t\t</script>\n\t\t\t\t\t<div class=\"dropdown\" id=\"drop'.$i.'\" style=\"display:none;\">\n\t\t\t\t\t\t<h5><strong>UCInetID:</strong> \t'.$row['ucinetid'].'</h5>\n\t\t\t\t\t\t<h5><strong>Name:</strong> \t\t'.$row['name'].'</h5>\n\t\t\t\t\t\t<h5><strong>Major:</strong> \t'.$row['major'].'</h5>\n\t\t\t\t\t\t<h5><strong>Level:</strong> \t'.$row['level'].'</h5>\n\t\t\t\t\t\t<h5><strong>Time:</strong>\t\t'.date('M j, Y,', strtotime($row['date'])).' '.date('g:i:s A', strtotime($row['time'])).'</h5>\n\t\t\t\t\t</div>\n\t\t\t\t</div>';\n\t\t}\n\t\t\n\t\t//view all link at the bottom of page\n\t\tif($_GET['view'] == 'all')\n\t\t{\n\t\t$ticker_content .= '\n\t\t\t<div class=\"row center\">\n\t\t\t<label id=\"view\"><a href=\"'.$_SERVER['PHP_SELF'].'?eid='.$_GET['eid'].'&view=less#view\">View Less Scans</a></label>\n\t\t\t</div>';\n\t\t}\n\t\telse \n\t\t{\n\t\t$ticker_content .= '\n\t\t\t<div class=\"row center\">\n\t\t\t<label id=\"view\"><a href=\"'.$_SERVER['PHP_SELF'].'?eid='.$_GET['eid'].'&view=all#view\">View All Scans</a></label>\n\t\t\t</div>';\n\t\t}\n\t}\n\telse {\n\t\t$ticker_content .= '\n\t\t<div class=\"list\">\n\t\t<div class=\"row\">\n\t\t\t<label>No Scans Yet</label>\n\t\t</div>\n\t\t</div>';\n\t}\n\t$ticker_content .= '</div>';\n\t\n\t\n\t/*\n\t * \t\tstart Statistics display \n\t *\n\t *  \n\t */\n\t \n\t$box->setContent( $bottom.$ticker_content);\n\t$box->setBadge('Return to Events', 'events.php');\n\t$var_array = new VarArray();\n\t\n\t\n\tforeach ($var_array->getMajors() as $major) {\n\t\t\n\t\t$sql = 'SELECT *\n\t\t\t\tFROM scans\n\t\t\t\tLEFT JOIN users \n\t\t\t\tON scans.barcode = users.barcode\n\t\t\t\tWHERE scans.eid = \"'.$scan['eid'].'\"\n\t\t\t\tAND users.major = \"'.$major.'\"';\n\t\t$page->DB->query($sql);\n\t\t$temp = $page->DB->numRows();\n\t\t//echo '<br>value:'.$temp;\n\t\n\t\t$majors[$major] = $temp;\n\t}\n\t\n\t$majors_stat = new Statistic('pie', 'user_majors', 'Registered Users - Major', $majors, 0);\n\t\n\t$bottom_stats = $majors_stat->display();\n\t\n\t$box_stat = new Box('Statistics', $bottom_stats);\n\t$stat_display = '<div class=\"separator\"></div>'.$box_stat->display(\"full\");\n\t$content = $box->display().$stat_display;\n\t\n\t$page->setContent($content);\n\t$page->buildPage();\n}\n?>\n\t"]],"start1":0,"start2":0,"length1":0,"length2":5507}]],"length":5507}
