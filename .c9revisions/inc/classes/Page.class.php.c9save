{"ts":1378759594743,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\nsession_start();\n/**\n * Page Class\n *\n * @description this class will contain all the output code such as headers and footers. A session is started to utilize php sessions, and will be used to validate login. More code can be found in the Login.class.php and Session.class.php files. This class constructs a new page template and stores the page in the MySQL Table \"pages\". It also has a DB object from DB.class.php available, a Login object from Login.class.php, and a Session Object from Sessions.class.php. Each page consists of several parts: HTML, header, navigation, content and footer. Each function builds a part of the page after it is called. See the buildPage() for more details.\n * @author Sean Burke, http://www.seantburke.com\n *\n * Page($name, $access);\n * setCSS($css);\n * setMessage($message, $class);\n * setTitle($title);\n * setContent($content_bottom);\n * buildPage();\n *\n **/\n\nclass Page\n{\n\n\tpublic $ID; \t\t\t\t//MySQL unique identifier\n\tpublic $access; \t\t\t//access of each page. See 'inc/constants.inc.php' for access constants\n\tpublic $alert;\t\t\t\t//class for the $message (e.g. 'failure' , 'success')\n\tpublic $banner; \t\t\t//html for the $message\n\tpublic $css;\t\t\t\t//additional css file for the page\n\tpublic $content;\t\t\t//the HTML code for the completed page\n\tpublic $content_bottom;\t\t//content of the bottom section; exludes HTML headers, nav, etc.\n\tpublic $description;\t\t//Description of the page\n\tpublic $extra_meta;\t\t\t//Any extra meta data for the page to include in the header\n\tpublic $footer;\t\t\t\t//the footer HTMl\n\tpublic $graph;\t\t\t\t//if you are going to use graphs on this page, you set this\n\tpublic $google;\t\t\t\t//Google Analytics Code\n\tpublic $html_tag;\t\t\t//if any extra information needs to be added to <html>\n\tpublic $html;\t\t\t\t//the html code between the <head> tag\n\tpublic $header;\t\t\t\t//the header content html code\n\tpublic $isPhone;\t\t\t//is this being viewed on an iPhone?\n\tpublic $js;\t\t\t\t\t//Initial JavaScript without the Document portion\n\tpublic $js_inital;\t\t\t//any initial javascript that needs to be run, e.g. div.hide()\n\tpublic $logo_src;\t\t\t//src of the logo image\n\tpublic $keywords;\t\t\t//keywords for the page, (not really important)\n\tpublic $message;\t\t\t//the alert message at the top of the page, needs $banner+$alert\n\tpublic $name;\t\t\t\t//name of the page\n\tpublic $navigation;\t\t\t//the navigation html code\n\tpublic $pageviews;\t\t\t//count of page views\n\tpublic $tab;\t\t\t\t//the tab, if any, that the page belongs to\n\tpublic $title;\t\t\t\t//the <title> of the page\n\tpublic $url;\t\t\t\t//url of the page\n\n\t//objects\n\tpublic $DB;\t\t\t\t\t// DB Object from 'inc/classes/DB.class.php'\n\t//public $session;\t\t\t// Session Object from 'inc/classes/Session.class.php'\n\tpublic $login;\t\t\t\t// Login Object from 'inc/classes/Login.class.php'\n\tpublic $nav;\t\t\t\t//the NavBar object\n\tpublic $sniper;\t\t\t\t// Stores all error messages and/or hackers\n\n\n\t/**\n\t * Constructs page object\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param string $name, Integer $access\n\t * @return void\n\t * @desc This constructor will construct the Page object by taking in the Name of the page, and the Access Level. See 'inc/constants.inc.php' for access constants.\n\t */\n\tfunction __construct($name, $access = ALL)\n\t{\n\t\t$this->DB = new DB();\n\t\t//$this->session = new Session();\n\t\t$this->login = new Login();\n\t\t$this->sniper = new Sniper();\n\t\t$this->name = $name;\n\t\t$this->access = $access;\n\t\t$this->setGoogleAnalytics();\n\n\t\t$sql = \"SELECT p.* FROM pages AS p\n\t\t\t\tWHERE name = '$name'\";\n\n\t\tif(!($this->DB->query($sql)))\n\t\tdie('Could not get page: '.$this->DB->getError());\n\t\t\t\n\t\t$page = $this->DB->resultToSingleArray($result);\n\n\t\tif ($page == '')\n\t\t{\n\t\t\t$sql = \"INSERT INTO pages (name, access)\n\t\t\t\t\tVALUES ('$name', '$access')\";\n\t\t\tif(!($this->DB->query($sql)))\n\t\t\tdie('Could not insert page: '.$this->DB->getError());\n\t\t}\n\t\t\n\t\tif(strstr($_SERVER['HTTP_USER_AGENT'], 'iPhone'))\n\t\t\t$this->isPhone = true;\n\t\telse \n\t\t\t$this->isPhone = false;\n\t\t\t\n\t\t$this->name = strtolower($page['name']);\n\t\t$this->access = $access;\n\t\t$this->ID = $page['ID'];\n\t\t$this->css = $page['css'];\n\t\t$this->url = $page['url'];\n\t\t$this->tab = $page['tab'];\n\t\t$this->pageviews = $page['views'];\n\t\t$this->description = $page['description'];\n\t\t$this->content = $page['content'];\n\t\t$this->title = ucfirst($page['name']);\n\t\t$this->logo_src = WEBSITE.'/images/logo200.png';\n\t\t\n\t\t$this->nav = new Nav($_SESSION['access'], $page['tab']);\n\t}\n\n\n\t/**\n\t * Sets Message\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @return void\n\t * @param string $message, string $class\n\t * @desc Sets the text of the message and the class which could be 'failure' or 'success' depending on the CSS associated. 'failure' will display a red alert and 'success' will display a green alert.\n\t */\n\n\tpublic function setMessage($message, $class)\n\t{\n\t\tif(is_array($message))\n\t\t{\n\t\t\t$this->message = implode(', ', $message);\n\t\t}\n\t\telse {\n\t\t\t$this->message = $message;\n\t\t}\n\t\t$this->alert = $class;\n\t\t\n\t\t//store the message with the sniper class for debugging\n\t\t$this->sniper->storeMessage($message, $_SESSION['ucinetid'], $class);\n\t}\n\n\t/**\n\t * Sets Title\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param $title\n\t * @return void\n\t * @desc Sets the title\n\t */\n\n\tpublic function setTitle($title)\n\t{\n\t\t$this->title = $title;\n\t}\n\n\t/**\n\t * Sets CSS\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param string $css\n\t * @return void\n\t * @desc Sets the css. Do not need to include the extension, e.g. enter $css = 'global' instead of 'global.css';\n\t */\n\n\tpublic function setCSS($css)\n\t{\n\t\t$this->css = $css;\n\t}\n\n\t/**\n\t * Sets description\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param string $description\n\t * @return void\n\t * @desc Sets the description of the page\n\t */\n\n\tpublic function setDescription($description)\n\t{\n\t\t$this->description = $description;\n\t}\n\n\t/**\n\t * Sets Keywords for the page\n\t * @param string $keywords\n\t */\n\n\tpublic function setKeywords($keywords)\n\t{\n\t\t$this->keywords = $keywords;\n\t}\n\n\tpublic function setJSInitial($js)\n\t{\n\t\t$this->js .= $js;\n\t}\n\t\n\tpublic function buildJSInitial()\n\t{\n\t\t$this->js_initial = '<script type=\"text/javascript\">\n\t\t$(document).ready(function() {';\n\t\t$this->js_initial .= $this->js;\n\t\t$this->js_initial .= ' });</script>';\n\t}\n\n\tpublic function addExtraMeta($extra_meta)\n\t{\n\t\t$this->extra_meta .= $extra_meta;\n\t}\n\n\tpublic function setContent($content_bottom)\n\t{\n\t\t$this->content_bottom = $content_bottom;\n\t}\n\t\n\t\t\n\tpublic function setTab($tab, $public_only = '0')\n\t{\n\t\t$this->tab = $tab;\n\t\t//$this->nav->addNewTab($this->tab, $this->title, $public_only, $this->access);\n\t}\n\t\n\t\n\tpublic function startGraph()\n\t{\n\t\t$this->graph = '<script type=\"text/javascript\" src=\"http://omnipotent.net/jquery.sparkline/2.1.1/jquery.sparkline.min.js\"></script>';\n\t}\n\t\n\tpublic function setGoogleAnalytics()\n\t{\n\t\t$this->google = '<script type=\"text/javascript\">\n\t\t\n\t\t  var _gaq = _gaq || [];\n\t\t  _gaq.push([\\'_setAccount\\', \\'UA-25773399-2\\']);\n\t\t  _gaq.push([\\'_trackPageview\\']);\n\t\t\n\t\t  (function() {\n\t\t    var ga = document.createElement(\\'script\\'); ga.type = \\'text/javascript\\'; ga.async = true;\n\t\t    ga.src = (\\'https:\\' == document.location.protocol ? \\'https://ssl\\' : \\'http://www\\') + \\'.google-analytics.com/ga.js\\';\n\t\t    var s = document.getElementsByTagName(\\'script\\')[0]; s.parentNode.insertBefore(ga, s);\n\t\t  })();\n\t\t\n\t\t</script>';\n\t}\n\n\tprivate function updatePageView()\n\t{\n\t\t$this->pageviews += 1;\n\t}\n\n\tprivate function updateURL()\n\t{\n\t\t$this->url = $_SERVER['PHP_SELF'];\n\t}\n\n\tprivate function updateAll()\n\t{\n\t\t$this->updatePageView();\n\t\t$this->updateURL();\n\t}\n\n\tprivate function writeSQL()\n\t{\n\t\t$content_bottom = addslashes($this->content_bottom);\n\t\t$title = addslashes($this->title);\n\t\t$content = addslashes($this->content);\n\t\t$description = addslashes($this->description);\n\n\t\t$sql = \"UPDATE pages SET\n\t\t\t\tdescription = '$description',\n\t\t\t\taccess = '$this->access',\n\t\t\t\turl = '$this->url',\n\t\t\t\tcss = '$this->css',\n\t\t\t\ttitle = '$title',\n\t\t\t\tviews = '$this->pageviews',\n\t\t\t\ttab = '$this->tab'\n\t\t\t\tWHERE name = '$this->name'\";\n\n\t\tif(!($result = $this->DB->query($sql)))\n\t\tdie('Could not update page: '.$this->DB->getError());\n\n\t}\n\t/**\n\t * Outputs the header html code\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param $css, $html_tag, $title, $description, $keywords, $extra_header_tags,\n\t * @return void\n\t * @desc This method will construct the header after each parameter is set\n\t * @access private\n\t */\n\n\tprivate function buildHTML()\n\t{\n\t\tif($this->isPhone)\n\t\t{\n\t\t\t$css = 'iPhone';\n\t\t\t$this->addExtraMeta('\n\t\t\t<link rel=\"apple-touch-startup-image\" href=\"images/fb-splash.png\">\n\t\t\t<link rel=\"apple-touch-icon-precomposed\" href=\"images/facebook.png\"/>\n\t\t\t<link media=\"only screen and (max-device-width: 480px)\"\n\t\t\t    href=\"/css/iPhone.css\" type=\"text/css\" rel=\"stylesheet\" />\n\t\t\t\n\t\t\t<meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black\" />\n\t\t\t<meta name=\"apple-mobile-web-app-capable\" content=\"yes\" />\n\t\t\t<meta name=\"viewport\" content=\"user-scalable=no,width=device-width,height=device-height\" />\n\t\t\t<meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\" />\t\t\t\n\t\t\t<meta name=\"apple-touch-fullscreen\" content=\"yes\" />\n\t\t\t<meta name=\"viewport\" content=\"width=320\" />');\n\t\t}\t\n\t\telse\n\t\t\t$css = 'global';\n\t\t\t\n\t\t$css = ($css) ? '<link rel=stylesheet type=\"text/css\" href=\"css/'.$css.'.css\"  >' : '';\n\n\t\t$this->html =\n\t\t'<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n\t\t<html>\n\t\t<head>\n\t\t\t<title>'.$this->title.' - '.PRODUCT.'</title>\n\t\t\t<link rel=\"shortcut icon\" href=\"/favicon.ico\">\n\t\t\t<link rel=\"icon\" href=\"/favicon.ico\" type=\"image/x-icon\">\n\t\t\t<meta property=\"og:title\" content=\"'.PRODUCT.'\" />\n\t\t\t<meta property=\"og:type\" content=\"website\" />\n\t\t\t<meta property=\"og:url\" content=\"'.$_SERVER['PHP_SELF'].'\" />\n\t\t\t<meta property=\"og:image\" content=\"'.$this->logo_src.'\" />\n\t\t\t<meta property=\"og:description\" content=\"'.$this->description.'\" />\n\t\t\t<meta property=\"fb:app_id\" content=\"203055886388488\" />\n\t\t\t<meta property=\"fb:admin\" content=\"hawaiianchimp\" />\n\t\t\t'.$this->extra_meta.'\n\t\t\t<meta http-equiv=\"X-UA-Compatible\" content=\"chrome=1\" />\n\t\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n\t\t\t<meta name=\"description\" content=\"'.$this->description.'\">\n\t\t\t<meta name=\"keywords\" content=\"'.$this->keywords.'\">\n\t\t\t<script src=\"http://code.jquery.com/jquery-latest.js\"></script>\n\t\t\t<script type=\"text/javascript\" src=\"http://www.google.com/jsapi\"></script>\n\t\t\t<script type=\"text/javascript\">\n\t\t\t\tgoogle.load(\\'visualization\\', \\'1\\', {packages: [\\'corechart\\']});\n\t\t\t</script>'\n\t\t    .$this->graph\n\t\t    .$this->js_initial\n\t\t    .$css\n\t\t    .$this->google\n\t\t.'</head>';\n\t}\n\tprivate function buildMessage()\n\t{\n\t\tif(isset($this->message))\n\t\t{\n\t\t\t$this->banner = '\n\t\t\t<div id=\"delay\">\n\t\t\t\t<div id=\"message\" class=\"message2 '.$this->alert.'\">\n\t\t\t\t\t<span id=\"x\" class=\"'.$this->alert.'\">X</span> '.$this->message.'\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<script>\n\t\t\t\t$(\"#x\").click(function(){\n\t\t\t\t\t$(\"#message\").fadeOut(\"slow\");\n\t\t\t\t});\n\t\t\t\t$(\"#delay\").delay(20000).fadeOut(\"slow\");\n\t\t\t</script>';\n\t\t}\n\t}\n\n\tprivate function buildHeader()\n\t{\n\t\t$this->buildMessage();\n\t\t\n\t\t$this->header = ' <body>\n\t\t<div id=\"wrapper\">'\n\t\t.$this->banner.'\n\t\t<div id=\"header\">\n\t\t\t<div id=\"logo\">\n\t\t\t\t<a href=\"index.php?r=logo\">\n\t\t\t\t<img src=\"'.$this->logo_src.'\" alt=\"'.PRODUCT.'\">\n\t\t\t\t<div id=\"logoname\"><h2>'.PRODUCT.'</h2></div>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t'.$this->login->loginFormMini('login','login.php','loginmini', $this->isPhone).'\n\t\t\t<div id=\"today\"><h2>Today: '.date('M d, h:i A', strtotime(NOW_DATE.' '.NOW_TIME)).'</h2></div>\n\t\t</div>';\n\t}\n\n\t/**\n\t * Builds the navigation bar\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @return void\n\t * @desc This function will build the navigation bar\n\t * @access private\n\t */\n\tprivate function buildNav()\n\t{\t\n\t\t$this->navigation = $this->nav->display();\n\t}\n\n\t/**\n\t * builds Content with the top and bottom\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param $content_top, $content_bottom\n\t * @return void\n\t * @access private\n\t * @desc This function will build the content of the page\n\t */\n\tprivate function buildContent()\n\t{\n\t\t$this->content = '\n\t\t<div id=\"container\">\n \t\t'.$this->content_bottom.'</div>';\n\t}\n\n\n\t/**\n\t * Outputs the footer html code\n\t *\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @param $pageviews\n\t * @return void\n\t * @access private\n\t * @desc This function will build the footer of the page\n\t */\n\tprivate function buildFooter()\n\t{\n\t\t$this->footer = '\n\t\t</div>\n\t\t\n\t\t<div id=\"copyright\">\n\t\t\t<p>Created for <a href=\"'.WEBSITE.'\">'.ORGANIZATION.'</a> | \n\t\t\tDeveloped by <a href=\"http://www.seantburke.com/?r=escan\">Sean Thomas Burke</a> | \n\t\t\t&copy; '.date('Y').' '.PRODUCT.' | \n\t\t\tViews: '.$this->pageviews.'</p>\n\t\t</div>\n\t\t\n\t\t</div>\n\t\t\n\t\t<script type=\"text/javascript\">\n\t\t\n\t\t  var _gaq = _gaq || [];\n\t\t  _gaq.push([\\'_setAccount\\', \\'UA-25773399-3\\']);\n\t\t  _gaq.push([\\'_trackPageview\\']);\n\t\t\n\t\t  (function() {\n\t\t    var ga = document.createElement(\\'script\\'); ga.type = \\'text/javascript\\'; ga.async = true;\n\t\t    ga.src = (\\'https:\\' == document.location.protocol ? \\'https://ssl\\' : \\'http://www\\') + \\'.google-analytics.com/ga.js\\';\n\t\t    var s = document.getElementsByTagName(\\'script\\')[0]; s.parentNode.insertBefore(ga, s);\n\t\t  })();\n\t\t\n\t\t</script>\n\t\t\n\t\t</body>\n\t\t</html>';\n\n\t}\n\n\n\n\t/**\n\t * @author Sean Burke, http://www.seantburke.com\n\t * @desc This method will build the entire page using each private build function above\n\t * @example buildPage()\n\t * @return void\n\t * @access public\n\t * @copyright 2011 Sean Burke\n\t */\n\tpublic function buildPage()\n\t{\n\t\t$this->updateAll();\n\t\t$this->buildJSInitial();\n\t\t$this->buildHTML();\n\t\t$this->buildHeader();\n\t\t$this->buildNav();\n\t\t$this->buildContent();\n\t\t$this->buildFooter();\n\t\t$this->content = $this->html.$this->header.$this->navigation.$this->content.$this->footer;\n\t\techo $this->content;\n\t\t$this->writeSQL();\n\t\texit;\n\t}\n}\n\n?>"]],"start1":0,"start2":0,"length1":0,"length2":13983}]],"length":13983}
{"contributors":[],"silentsave":false,"ts":1378764950125,"patch":[[{"diffs":[[0,"/script>"],[1,"\n\t\t\t<script type=\"text/javascript\" src=\"javascript/escan.js\""],[0,"'\n\t\t    "]],"start1":10610,"start2":10610,"length1":16,"length2":76}]],"length":14043,"saved":false}
{"ts":1378765076897,"patch":[[{"diffs":[[0,"rapper\">"],[1,"\n\t\t<div id=\"banner\">"],[0,"'\n\t\t.$th"]],"start1":11294,"start2":11294,"length1":16,"length2":36},{"diffs":[[0,"anner.'\n"],[1,"\t\t</div>\n"],[0,"\t\t<div i"]],"start1":11335,"start2":11335,"length1":16,"length2":25}]],"length":14072,"saved":false}
